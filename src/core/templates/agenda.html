{% extends "base.html" %}
{% load pauta_participativa_tags %}

{% block content %}
  {% if user|already_voted:object %}
    <div class="">
      <h1>{{object.title}}</h1>
      <p>{{object.description}}</p>
      {% for group in object.groups.all %}
        <div class="">
          <h2>{{group.theme.name}}</h2>
          <ul>
            {% ordered_proposals group object as proposals %}
            {% for proposal in proposals %}
              <li>
                <h3>{{proposal.title}}</h3>
                <p>Upvotes: {{proposal|upvotes:object}}</p>
                <p>Downvotes: {{proposal|downvotes:object}}</p>
                <p>Score: {{proposal|score:object}}</p>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="js-agenda" data-agenda-id="{{object.id}}">
      <h1>{{object.title}}</h1>
      <p>{{object.description}}</p>
      {% for group in agenda.groups.all %}
        <div class="js-group" data-group-id="{{group.id}}" data-group-theme>
          <h2>{{group.theme.name}}</h2>
          <div class="js-group-header">
            <span>Seus votos:</span>
            <ul class="js-votes-list">
              <li class="js-vote js-upvote">upvote</li>
              <li class="js-vote js-upvote">upvote</li>
              <li class="js-vote js-downvote">downvote</li>
            </ul>
          </div>
          <form class="js-group-form" action="">
            <ul>
              {% for proposal in group.proposals.all %}
                <li class="js-proposal" data-title="{{proposal.title}}">
                  <h3>{{proposal.title}}</h3>
                  <input type="checkbox" name="{{proposal.id}}" id="group{{group.id}}-checkbox{{proposal.id}}" class="vote-checkbox js-checkbox">
                  <label class="vote js-vote-checkbox" for="group{{group.id}}-checkbox{{proposal.id}}"></label>
                  <p>{{proposal.description}}</p>
                </li>
              {% endfor %}
            </ul>
          </form>
          <button class="js-next-group">Proximo</button>
        </div>
      {% endfor %}
      <button class="js-send-votes">Enviar</button>
      <div class="js-votes-review">
        {% for group in agenda.groups.all %}
          <div class="js-group-review" data-group-id="{{group.id}}">
            <h2>{{group.theme.name}}</h2>
            <ul class="js-voted-list"></ul>
          </div>
        {% endfor %}
        <button class="js-review-back-btn">Voltar</button>
        <form action="" class="js-submit-votes-form">
          {% csrf_token %}
          <div class="g-recaptcha" data-sitekey="6LeqwioUAAAAAJQwLBKGmmpuazIQM6hEYYoFSTYW"></div>
          <button class="js-submit-votes-btn">Confirmar</button>
        </form>
      </div>
    </div>
  {% endif %}
{% endblock content %}
